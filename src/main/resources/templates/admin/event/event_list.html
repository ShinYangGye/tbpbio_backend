<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{fragments/comm :: comm-head}">
  
  </head>
  <body>
  
	 <nav th:replace="~{fragments/comm :: navbar}"></nav>
 
	 <div class="container my-2">
	    
	    <h4>이벤트 관리</h4>

		<!-- 이벤트 등록  ------------------------------------>
		<div class="mb-4">
		<form th:object="${item}" th:action method="POST" enctype="multipart/form-data" onSubmit="return goSave();">
		  <div class="row mb-3">
		    <label for="title" class="col-sm-2 col-form-label">제목</label>
		    <div class="col-sm-10">
		      <input type="text" maxlength=100 class="form-control" th:field="*{title}">
		    </div>
		  </div>
		  <div class="row mb-3">
		    <label for="title" class="col-sm-2 col-form-label">요약</label>
		    <div class="col-sm-10">
		      <input type="text" maxlength=100 class="form-control" th:field="*{summary}">
		    </div>
		  </div>
		  <div class="row mb-3">
		    <label for="contents" class="col-sm-2 col-form-label">내용</label>
		    <div class="col-sm-10">
		      <textarea class="form-control" th:field="*{contents}" rows="7"></textarea>
		    </div>
		  </div>
		  <fieldset class="row mb-3">
		    <label for="attachFile" class="col-sm-2 col-form-label">이벤트 상세보기 파일</label>
		    <div class="col-sm-10">
				<input class="form-control" type="file" th:field="*{attachFile}" >
		    </div>
		  </fieldset>
		  
		  <fieldset class="row mb-3">
		    <label for="imgFile" class="col-sm-2 col-form-label">이벤트 이미지</label>
		    <div class="col-sm-10">
				<input class="form-control" type="file" th:field="*{imgFile}" accept="image/*" >
		    </div>
		  </fieldset>
		  
		  <fieldset class="row mb-3">
		    <label for="imgListFile" class="col-sm-2 col-form-label">이벤트 목록 이미지</label>
		    <div class="col-sm-10">
				<input class="form-control" type="file" th:field="*{imgListFile}" accept="image/*" >
		    </div>
		  </fieldset>
		
		<div class="d-grid gap-2 d-md-flex justify-content-md-end">
		  <button class="btn btn-secondary me-md-2" type="submit">이벤트 등록</button>
		  <button class="btn btn-secondary" type="reset">등록 취소</button>
		</div>
		
		</form>		
		</div>	    
		<!-- // 이벤트 등록 ----------------------------------->
		
		<hr />
		
		<!-- 이벤트 목록 ----------------------------------->	    
		<div class="accordion accordion-flush" id="accordionFlushExample">
		  <div class="accordion-item" th:each="item, itemStat : ${items}">
		    <h2 class="accordion-header">
		      <button class="accordion-button collapsed text-bg-secondary" type="button" data-bs-toggle="collapse" th:attr="data-bs-target=|#flush-collapse-${item.id}|, aria-controls=|#flush-collapse-${item.id}|"  aria-expanded="false">
		       	<div>
		       	<span th:text="${item.title}"></span>     		       	  	
		       	</div>
		      </button>
		    </h2>
		    <div   th:attr="id=|flush-collapse-${item.id}|" class="accordion-collapse collapse text-bg-light p-2" data-bs-parent="#accordionFlushExample">
		      <div class="accordion-body">
		      	<div>

		      	<div class="m-2"><strong><span>이벤트 관리번호 : </span><span th:text="${item.id}"></span></strong></div>
				<div>
					이벤트 상태 : 
										
                	<span class="badge text-bg-danger" style="width: 100px; font-size: 14px; padding: 8px;" th:if="${item.status == 'I'}">진행중</span>
                	<span class="badge text-bg-secondary" style="width: 100px; font-size: 14px; padding: 8px;" th:if="${item.status == 'E'}">종료</span>				
										
					<button class="btn btn btn-sm btn-danger" style="margin-bottom: 5px;" th:onclick="goStatus([[${item.id}]], 'I');">진행상태로 변경</button>
					<button class="btn btn btn-sm btn-secondary"  style="margin-bottom: 5px;" th:onclick="goStatus([[${item.id}]], 'E');">종료상태로 변경</button></div>
		      	<textarea class="form-control" rows="7" readonly th:text="${item.contents}"></textarea>
		      	</div>
		      	<hr />
		      	
		      	<div th:if="${item.imgFile}">      			
		      		<img th:src="|/api/event/files/${item.imgFile.savedFileName}|" class="w-100">
		      	</div>
		      	
		      	<hr />
		      	
		      	<div th:if="${item.file}">      		
		      		첨부파일 : <a th:href="|/api/event/files/${item.file.savedFileName}|" th:text="${item.file.orgFileName}" target="_blank"></a> 		
		      	</div>
		      	<div>
			    	등록일시 : <span th:text="${#dates.format(item.regAt, 'yyyy-MM-dd HH:mm:ss')}"></span>
			    </div>	    
		    
				<div class="d-grid gap-2 d-md-flex justify-content-md-end">
				 <!-- 
				  <a th:href="|/admin/event/${item.id}/delete|" class="btn btn btn-outline-secondary">삭제</a>
				  -->
				  <button class="btn btn btn-outline-secondary" th:onclick="goDelete([[${item.id}]]);">삭제</button>	  
				</div>    
		    </div>
		  </div>
		</div>	    
		<!-- // 이벤트 목록 ----------------------------------->
	</div>
	
    <script th:replace="~{fragments/comm :: bottom-script}"></script>
    
    <script th:inline="javascript">
    
    	// 이벤트 저장
    	let goSave = function() {
			
			let title = document.getElementById('title').value;
			let contents = document.getElementById('contents').value;
			let summary = document.getElementById('summary').value;
			let imgListFile = document.getElementById('imgListFile').value;
			
			if (title.trim() == '') {
				alert("제목을 입력하세요.");
				document.getElementById('title').focus();
				return false;
			}
			
			if (summary.trim() == '') {
				alert("요약을 입력하세요.");
				document.getElementById('summary').focus();
				return false;
			}
			
			if (contents.trim() == '') {
				alert("내용을 입력하세요.");
				document.getElementById('contents').focus();
				return false;
			}
			
			if (imgListFile.trim() == '') {
				alert("이벤트 목록 이미지를 선택하세요.");
				document.getElementById('imgListFile').focus();
				return false;
			}
			
			return true;
    		
    	}
    
    	// 이벤트 삭제
    	let goDelete = function(id) {
    		
    		let conf = confirm("해당 이벤트를 삭제합니까?");
    		
    		if (conf) {
    			location.href = "/admin/event/"+ id +"/delete";
    		}
    		  		
    	}
    	
    	// 상태변경
    	let goStatus = function(id, status) {  		
			location.href = "/admin/event/"+ id +"/status/" + status;   		  		
    	}
    
    </script>
  
  </body>
</html>